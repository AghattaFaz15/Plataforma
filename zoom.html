<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zoom com Slow Motion</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: black;
    color: white;
    font-family: Arial, sans-serif;
  }
  video {
    max-width: 100%;
    margin: 10px 0;
    background: black;
  }
  button {
    padding: 10px 20px;
    margin: 10px;
    font-size: 18px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1>Zoom com Slow Motion</h1>
<video id="preview" autoplay playsinline></video>
<button id="startBtn">ðŸŽ¥ Gravar 10s</button>
<video id="finalVideo" controls style="display:none;"></video>

<script>
const preview = document.getElementById('preview');
const startBtn = document.getElementById('startBtn');
const finalVideo = document.getElementById('finalVideo');

let stream;
let recordedChunks = [];

async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({
    video: {
      facingMode: "user",
      zoom: 2.0 // zoom inicial
    },
    audio: false // sem Ã¡udio
  });
  preview.srcObject = stream;
}

startCamera();

startBtn.addEventListener('click', async () => {
  recordedChunks = [];

  const options = { mimeType: 'video/webm; codecs=vp9' };
  const recorder = new MediaRecorder(stream, options);

  recorder.ondataavailable = e => {
    if (e.data.size > 0) recordedChunks.push(e.data);
  };

  recorder.onstop = processSlowMotion;

  recorder.start();
  startBtn.disabled = true;

  setTimeout(() => {
    recorder.stop();
    startBtn.disabled = false;
  }, 10000); // grava apenas 10s
});

function processSlowMotion() {
  const recordedBlob = new Blob(recordedChunks, { type: 'video/webm' });
  const tempVideo = document.createElement('video');
  tempVideo.src = URL.createObjectURL(recordedBlob);
  tempVideo.muted = true;
  tempVideo.playbackRate = 1;
  tempVideo.crossOrigin = "anonymous";

  tempVideo.addEventListener('loadedmetadata', () => {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = tempVideo.videoWidth;
    canvas.height = tempVideo.videoHeight;

    const slowChunks = [];
    const slowStream = canvas.captureStream();
    const slowRecorder = new MediaRecorder(slowStream, { mimeType: 'video/webm; codecs=vp9' });

    slowRecorder.ondataavailable = e => {
      if (e.data.size > 0) slowChunks.push(e.data);
    };

    slowRecorder.onstop = () => {
      const slowBlob = new Blob(slowChunks, { type: 'video/webm' });
      finalVideo.src = URL.createObjectURL(slowBlob);
      finalVideo.style.display = "block";

      // Baixar automaticamente
      const a = document.createElement('a');
      a.href = finalVideo.src;
      a.download = 'video_slowmotion.webm';
      a.click();
    };

    let frameInterval = 1000 / 30; // 30 fps
    let repeatFrames = 6; // slow motion 6Ã—

    slowRecorder.start();

    tempVideo.play();

    const drawFrame = () => {
      if (tempVideo.paused || tempVideo.ended) {
        slowRecorder.stop();
        return;
      }
      ctx.drawImage(tempVideo, 0, 0, canvas.width, canvas.height);

      // Repete o mesmo quadro vÃ¡rias vezes para o slow
      let count = 0;
      const repeat = () => {
        if (count < repeatFrames) {
          ctx.drawImage(tempVideo, 0, 0, canvas.width, canvas.height);
          count++;
          setTimeout(repeat, frameInterval);
        } else {
          requestAnimationFrame(drawFrame);
        }
      };
      repeat();
    };

    tempVideo.play();
    drawFrame();
  });
}
</script>

</body>
</html>
