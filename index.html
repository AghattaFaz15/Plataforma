<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>üé¨ Grava√ß√£o 360¬∞</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
:root { --azul:#0b132b; --dourado:#d4af37; }
body { font-family:system-ui,sans-serif; text-align:center; background:var(--azul); color:#fff; margin:0; padding:30px;}
button { padding:12px 22px; font-size:18px; border:none; border-radius:10px; cursor:pointer; color:#fff; background:var(--dourado); margin:10px; box-shadow:0 6px 16px rgba(0,0,0,.25);}
video { width:100%; max-height:55vh; margin:10px auto; border:3px solid var(--dourado); }
#qrCode { width:200px; height:200px; margin:20px auto; display:grid; place-items:center; border:2px solid var(--dourado); border-radius:12px; }
iframe { display:none; width:0; height:0; }
</style>
</head>
<body>

<h2>üé¨ Grava√ß√£o 360¬∞ Integrada</h2>
<button id="startBtn">‚ñ∂Ô∏è Iniciar Grava√ß√£o</button>
<audio id="bgMusic" src="musica.mp3" preload="auto"></audio>

<video id="previewVideo" controls></video>
<div id="qrCode"></div>

<iframe id="zoomFrame" src="zoom.html"></iframe>
<iframe id="slowFrame" src="slow.html"></iframe>

<script>
const startBtn = document.getElementById('startBtn');
const zoomFrame = document.getElementById('zoomFrame');
const slowFrame = document.getElementById('slowFrame');
const previewVideo = document.getElementById('previewVideo');
const qrBox = document.getElementById('qrCode');
const bgMusic = document.getElementById('bgMusic');

let chunksReceived = [];
function makeQR(url){
  qrBox.innerHTML = '';
  new QRCode(qrBox, { text:url, width:200, height:200, correctLevel:QRCode.CorrectLevel.H });
}

// Recebe o v√≠deo dos iframes
window.addEventListener('message', e=>{
  if(e.data.videoBlob){
    const blob = e.data.videoBlob;
    const url = URL.createObjectURL(blob);
    previewVideo.src = url;
    previewVideo.play();
    makeQR(url);
  }
});

startBtn.onclick = ()=>{
  chunksReceived = [];
  previewVideo.src = '';
  qrBox.innerHTML = '';
  bgMusic.currentTime = 0;
  bgMusic.play();
  zoomFrame.contentWindow.postMessage({ action:'start' }, '*');
  slowFrame.contentWindow.postMessage({ action:'start' }, '*');
};
</script>

</body>
</html>
