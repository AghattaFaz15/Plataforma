<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gravar, Editar e Salvar V√≠deo</title>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        background: #0b2545;
        color: white;
        padding: 20px;
    }
    video {
        width: 100%;
        max-width: 400px;
        border: 3px solid gold;
        border-radius: 10px;
        margin-bottom: 15px;
    }
    button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
    }
    #qrcode {
        margin-top: 20px;
    }
</style>
</head>
<body>

<h1>üé• Grava√ß√£o e Edi√ß√£o</h1>

<video id="preview" autoplay playsinline></video>
<video id="editPreview" controls style="display:none;"></video>

<br>
<button id="startBtn" style="background:green; color:white;">Iniciar Grava√ß√£o</button>
<button id="stopBtn" style="background:red; color:white;" disabled>Parar</button>
<button id="processBtn" style="background:gold; color:black;" disabled>Processar Edi√ß√£o</button>
<button id="uploadBtn" style="background:blue; color:white;" disabled>Enviar p/ Firebase</button>

<div id="qrcode"></div>

<script>
// --- CONFIG DO FIREBASE ---
const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_AUTH_DOMAIN",
    projectId: "SEU_PROJECT_ID",
    storageBucket: "SEU_STORAGE_BUCKET",
    messagingSenderId: "SEU_SENDER_ID",
    appId: "SUA_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const storage = firebase.storage();

// --- VARI√ÅVEIS ---
let mediaRecorder;
let recordedChunks = [];

// --- ACESSAR C√ÇMERA ---
const preview = document.getElementById('preview');
navigator.mediaDevices.getUserMedia({ video: true, audio: true })
.then(stream => {
    preview.srcObject = stream;
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.ondataavailable = e => {
        if (e.data.size > 0) recordedChunks.push(e.data);
    };
})
.catch(err => alert("Erro ao acessar c√¢mera: " + err));

// --- GRAVAR ---
document.getElementById('startBtn').onclick = () => {
    recordedChunks = [];
    mediaRecorder.start();
    document.getElementById('startBtn').disabled = true;
    document.getElementById('stopBtn').disabled = false;
};

document.getElementById('stopBtn').onclick = () => {
    mediaRecorder.stop();
    document.getElementById('stopBtn').disabled = true;
    document.getElementById('processBtn').disabled = false;
};

// --- PROCESSAR EDI√á√ÉO ---
document.getElementById('processBtn').onclick = async () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    const arrayBuffer = await blob.arrayBuffer();

    // Simples efeito de slow motion e zoom (simula√ß√£o)
    const videoURL = URL.createObjectURL(blob);
    const editPreview = document.getElementById('editPreview');
    editPreview.src = videoURL;
    editPreview.style.display = 'block';
    editPreview.playbackRate = 0.5; // Slow motion
    editPreview.style.transform = "scale(1.2)"; // Zoom simples

    document.getElementById('uploadBtn').disabled = false;
};

// --- UPLOAD PARA FIREBASE ---
document.getElementById('uploadBtn').onclick = async () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    const fileName = `videos/${Date.now()}.webm`;
    const ref = storage.ref().child(fileName);
    await ref.put(blob);
    const url = await ref.getDownloadURL();

    // --- GERAR QR CODE ---
    document.getElementById('qrcode').innerHTML = "";
    new QRCode(document.getElementById("qrcode"), {
        text: url,
        width: 200,
        height: 200
    });

    alert("V√≠deo enviado e QR Code gerado!");
};
</script>

</body>
</html>
