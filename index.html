<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Vídeo Cinemático com QRCode</title>
<style>
  body {
    background: black;
    color: white;
    text-align: center;
    font-family: sans-serif;
  }
  video {
    max-width: 100%;
    transform-origin: center center;
  }
</style>
</head>
<body>

<h1>🎥 Gravando com Efeito Cinemático</h1>
<video id="preview" autoplay playsinline></video>
<br>
<button id="startBtn">🎬 Iniciar Gravação</button>
<button id="stopBtn" disabled>⏹ Parar</button>
<div id="downloadArea"></div>
<canvas id="qrCanvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
let mediaRecorder;
let recordedChunks = [];
let stream;
const preview = document.getElementById('preview');

async function initCamera() {
  stream = await navigator.mediaDevices.getUserMedia({
    video: {
      facingMode: { exact: "environment" },
      zoom: 3 // valor inicial, navegador ajusta se suportar
    },
    audio: true
  });
  preview.srcObject = stream;
}

document.getElementById('startBtn').onclick = () => {
  recordedChunks = [];
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e => { if (e.data.size > 0) recordedChunks.push(e.data); };
  mediaRecorder.onstop = playVideoWithEffects;
  mediaRecorder.start();
  document.getElementById('startBtn').disabled = true;
  document.getElementById('stopBtn').disabled = false;
};

document.getElementById('stopBtn').onclick = () => {
  mediaRecorder.stop();
  document.getElementById('startBtn').disabled = false;
  document.getElementById('stopBtn').disabled = true;
};

function playVideoWithEffects() {
  const blob = new Blob(recordedChunks, { type: "video/webm" });
  const url = URL.createObjectURL(blob);

  // Cria um player separado para os efeitos
  const player = document.createElement('video');
  player.src = url;
  player.autoplay = true;
  player.controls = true;
  player.loop = true;
  document.body.appendChild(player);

  // Animação de zoom orgânico
  player.animate([
    { transform: "scale(1)" },
    { transform: "scale(1.2)" },
    { transform: "scale(1)" }
  ], {
    duration: 4000,
    iterations: Infinity
  });

  // Alternar velocidade lento/rápido
  let speeds = [0.5, 2];
  let i = 0;
  setInterval(() => {
    player.playbackRate = speeds[i % speeds.length];
    i++;
  }, 4000);

  // Gera link e QR Code
  const a = document.createElement('a');
  a.href = url;
  a.download = 'video_cinematico.webm';
  a.textContent = '📥 Baixar Vídeo';
  document.getElementById('downloadArea').appendChild(a);

  QRCode.toCanvas(document.getElementById('qrCanvas'), url, { width: 200 }, function (error) {
    if (error) console.error(error);
  });
}

initCamera();
</script>
</body>
</html>
