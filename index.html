<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grava√ß√£o</title>
<style>
body { background:black; color:white; font-family:Arial; text-align:center; margin:0; padding:0; }
.video-wrapper { width:100%; max-width:500px; margin:0 auto; overflow:hidden; border:2px solid gold; border-radius:10px; }
video { width:100%; display:block; transform-origin:center center; }
button { padding:10px 20px; margin-top:10px; font-size:16px; background:gold; border:none; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>

<h2>üé• Grava√ß√£o</h2>
<div class="video-wrapper">
  <video id="preview" autoplay playsinline></video>
</div>
<br>
<button id="startBtn">üé¨ Gravar 10s</button>
<button id="playbackBtn" disabled>‚ñ∂Ô∏è Ver Playback</button>

<script>
let stream, mediaRecorder, recordedChunks=[];

async function startCamera(){
  stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
  document.getElementById('preview').srcObject = stream;
}
startCamera();

document.getElementById('startBtn').addEventListener('click', ()=>{
  recordedChunks=[];
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e=>{ if(e.data.size>0) recordedChunks.push(e.data); };
  mediaRecorder.onstop = ()=>{ document.getElementById('playbackBtn').disabled=false; };
  mediaRecorder.start();

  // Garantir 10s exatas usando setTimeout
  setTimeout(()=>{ 
    if(mediaRecorder.state !== "inactive") mediaRecorder.stop(); 
  }, 10000);
});

// Bot√£o playback abre novo HTML com o Blob
document.getElementById('playbackBtn').addEventListener('click', ()=>{
  const blob = new Blob(recordedChunks,{type:'video/webm'});
  const url = URL.createObjectURL(blob);
  window.open(`playback.html?videoUrl=${encodeURIComponent(url)}`, '_blank');
});
</script>

</body>
</html>
