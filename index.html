<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>V칤deo com Zoom e Slow/Fast</title>
<style>
body {
  background: black;
  color: white;
  font-family: Arial, sans-serif;
  text-align: center;
  margin: 0;
  padding: 0;
}
#container-gravacao, #container-visualizacao, #container-qrcode {
  display: none;
  padding: 20px;
}
#container-gravacao { display: block; }
.video-wrapper {
  width: 100%;
  max-width: 500px;
  margin: 0 auto;
  overflow: hidden;
  border: 2px solid gold;
  border-radius: 10px;
}
video {
  width: 100%;
  display: block;
  transform-origin: center center;
}
button {
  padding: 10px 20px;
  margin-top: 10px;
  font-size: 16px;
  background: gold;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
</style>
</head>
<body>

<div id="container-gravacao">
  <h2>游꿘 Grava칞칚o</h2>
  <div class="video-wrapper">
    <video id="preview" autoplay playsinline></video>
  </div>
  <br>
  <button id="startBtn">游꿟 Gravar</button>
</div>

<div id="container-visualizacao">
  <h2>郊윒잺 Visualiza칞칚o</h2>
  <div class="video-wrapper">
    <video id="playback" controls></video>
  </div>
  <br>
  <button id="gerarQRBtn">游님 Gerar QR Code</button>
</div>

<div id="container-qrcode">
  <h2>游님 QR Code</h2>
  <div id="qrcode"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
let mediaRecorder;
let recordedChunks = [];
let stream;

// Inicia c칙mera sem 치udio
async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "environment" }
  });
  document.getElementById('preview').srcObject = stream;
}
startCamera();

// Grava칞칚o
document.getElementById('startBtn').addEventListener('click', () => {
  recordedChunks = [];
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e => {
    if(e.data.size > 0) recordedChunks.push(e.data);
  };
  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    const url = URL.createObjectURL(blob);
    const playback = document.getElementById('playback');
    playback.src = url;

    document.getElementById('container-gravacao').style.display = 'none';
    document.getElementById('container-visualizacao').style.display = 'block';

    // Inicia zoom org칙nico + altern칙ncia de velocidade
    startZoomAndSpeed(playback);
  };

  mediaRecorder.start();
  setTimeout(() => mediaRecorder.stop(), 10000); // grava 10s
});

// Zoom org칙nico e altern칙ncia de velocidade
function startZoomAndSpeed(video) {
  let scale = 1;
  let direction = 1;
  const speed = 0.0005; // zoom suave

  // Alterna velocidade: lento (0.5) -> r치pido (2) -> lento...
  video.playbackRate = 0.5; // inicia lento
  setInterval(() => {
    video.playbackRate = video.playbackRate === 0.5 ? 2 : 0.5;
  }, 4000);

  // Zoom org칙nico cont칤nuo
  function zoom() {
    scale += direction * speed;
    if(scale > 1.2) direction = -1;
    if(scale < 1) direction = 1;
    video.style.transform = `scale(${scale})`;
    requestAnimationFrame(zoom);
  }
  zoom();
}

// QR Code
document.getElementById('gerarQRBtn').addEventListener('click', () => {
  const blob = new Blob(recordedChunks, { type: 'video/webm' });
  const url = URL.createObjectURL(blob);
  document.getElementById('qrcode').innerHTML = '';
  new QRCode(document.getElementById('qrcode'), url);

  document.getElementById('container-visualizacao').style.display = 'none';
  document.getElementById('container-qrcode').style.display = 'block';
});
</script>

</body>
</html>
