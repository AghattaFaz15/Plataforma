<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C√¢mera Slow Motion + QR Code</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #000;
    color: #fff;
  }
  video {
    width: 100%;
    max-height: 70vh;
    border: 2px solid gold;
    border-radius: 10px;
  }
  button {
    margin: 10px;
    padding: 10px 20px;
    background: gold;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
  }
  #qrcode {
    margin-top: 20px;
  }
</style>
</head>
<body>

<h2>üé• Slow Motion com Zoom + QR Code</h2>
<video id="preview" autoplay playsinline muted></video><br>
<button id="startBtn">‚ñ∂ Iniciar Grava√ß√£o</button>
<button id="stopBtn" disabled>‚èπ Parar</button>
<video id="playback" controls style="display:none;"></video>
<div id="qrcode"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
let mediaRecorder;
let recordedChunks = [];
let stream;

async function startCamera() {
  try {
    stream = await navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: { exact: "environment" }, // c√¢mera traseira
        frameRate: { ideal: 120 }, // tenta slow motion real
        zoom: 3 // tentativa de zoom
      },
      audio: false
    });

    // Aplica zoom m√°ximo poss√≠vel
    const track = stream.getVideoTracks()[0];
    const capabilities = track.getCapabilities();
    if (capabilities.zoom) {
      await track.applyConstraints({ advanced: [{ zoom: capabilities.zoom.max }] });
    }

    document.getElementById("preview").srcObject = stream;
  } catch (err) {
    alert("Erro ao acessar c√¢mera: " + err);
    console.error(err);
  }
}

document.getElementById("startBtn").onclick = () => {
  recordedChunks = [];
  mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm;codecs=vp9' });
  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) recordedChunks.push(e.data);
  };
  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    const url = URL.createObjectURL(blob);

    const playback = document.getElementById("playback");
    playback.src = url;
    playback.style.display = "block";
    playback.playbackRate = 0.25; // deixa lento na reprodu√ß√£o
    playback.play();

    // Gera QR Code do link
    document.getElementById("qrcode").innerHTML = "";
    new QRCode(document.getElementById("qrcode"), url);
  };
  mediaRecorder.start();
  document.getElementById("startBtn").disabled = true;
  document.getElementById("stopBtn").disabled = false;
};

document.getElementById("stopBtn").onclick = () => {
  mediaRecorder.stop();
  document.getElementById("startBtn").disabled = false;
  document.getElementById("stopBtn").disabled = true;
};

startCamera();
</script>
</body>
</html>
