<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GravaÃ§Ã£o com Slow e Zoom</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: white;
    text-align: center;
    margin: 0;
    padding: 0;
  }
  .container {
    padding: 10px;
    margin-top: 10px;
  }
  video {
    width: 90%;
    max-width: 400px;
    border: 3px solid gold;
    border-radius: 10px;
  }
  button {
    margin: 5px;
    padding: 10px;
    border: none;
    background: gold;
    color: black;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
  }
  #qrcode {
    margin-top: 15px;
  }
</style>
</head>
<body>

<h2>ðŸŽ¥ GravaÃ§Ã£o CinematogrÃ¡fica</h2>

<div class="container" id="recordContainer">
  <video id="preview" autoplay playsinline></video><br>
  <button id="startBtn">ðŸŽ¬ Iniciar GravaÃ§Ã£o</button>
</div>

<div class="container" id="playbackContainer" style="display:none;">
  <video id="playback" controls></video><br>
  <button id="downloadBtn">â¬‡ Baixar VÃ­deo</button>
</div>

<div class="container" id="qrcodeContainer" style="display:none;">
  <h3>ðŸ“± Compartilhar</h3>
  <div id="qrcode"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
let mediaRecorder;
let recordedChunks = [];

async function initCamera() {
  const stream = await navigator.mediaDevices.getUserMedia({
    video: {
      facingMode: "environment",
      zoom: 3 // Zoom inicial se suportado
    },
    audio: false
  });
  document.getElementById('preview').srcObject = stream;
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e => {
    if (e.data.size > 0) recordedChunks.push(e.data);
  };
  mediaRecorder.onstop = () => {
    const blob = new Blob(recordedChunks, { type: 'video/webm' });
    recordedChunks = [];
    const videoURL = URL.createObjectURL(blob);
    const playback = document.getElementById('playback');
    playback.src = videoURL;

    // Efeito de slow + zoom sÃ³ na reproduÃ§Ã£o
    playback.onplay = () => {
      let zoomIn = true;
      setInterval(() => {
        playback.playbackRate = playback.playbackRate === 0.5 ? 2 : 0.5;
        playback.style.transform = zoomIn ? "scale(1.2)" : "scale(1)";
        zoomIn = !zoomIn;
      }, 2000);
    };

    document.getElementById('recordContainer').style.display = 'none';
    document.getElementById('playbackContainer').style.display = 'block';

    // QR Code
    document.getElementById('qrcodeContainer').style.display = 'block';
    document.getElementById('qrcode').innerHTML = '';
    new QRCode(document.getElementById('qrcode'), videoURL);
  };
}

document.getElementById('startBtn').addEventListener('click', () => {
  recordedChunks = [];
  mediaRecorder.start();
  setTimeout(() => {
    mediaRecorder.stop();
  }, 10000); // 10 segundos
});

document.getElementById('downloadBtn').addEventListener('click', () => {
  const blob = new Blob(recordedChunks, { type: 'video/webm' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'video.webm';
  a.click();
});

initCamera();
</script>

</body>
</html>
