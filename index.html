<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gravar, Slow + Zoom</title>
<style>
body { background:black; color:white; font-family:Arial; text-align:center; margin:0; padding:0; }
h1 { color:gold; }
video { width:100%; max-width:500px; border:2px solid gold; border-radius:10px; display:block; margin:auto; transform-origin:center center; }
#qrcode { margin-top:20px; }
button { background:gold; color:black; padding:10px 20px; border:none; border-radius:5px; font-size:16px; margin:10px; cursor:pointer; }
</style>
</head>
<body>

<h1>üé• Slow Motion + Zoom</h1>
<video id="preview" autoplay muted playsinline></video>
<br>
<button id="startBtn">‚ñ∂Ô∏è Iniciar Grava√ß√£o (10s)</button>
<div id="qrcode"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const CLOUD_NAME = "dxobnhynf";
const UPLOAD_PRESET = "default_preset"; // coloque o nome do seu preset

const videoEl = document.getElementById('preview');
let mediaRecorder, recordedChunks = [];

document.getElementById('startBtn').addEventListener('click', async () => {
  recordedChunks = [];
  const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
  videoEl.srcObject = stream;

  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e => { if (e.data.size > 0) recordedChunks.push(e.data); };
  mediaRecorder.onstop = async () => {
    const blob = new Blob(recordedChunks, { type: 'video/mp4' });
    const file = new File([blob], "video.mp4", { type: 'video/mp4' });

    // Upload para Cloudinary
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/video/upload`, {
      method: "POST",
      body: formData
    });
    const data = await res.json();
    const videoUrl = data.secure_url;

    // Mostra QRCode
    document.getElementById('qrcode').innerHTML = "";
    new QRCode(document.getElementById("qrcode"), videoUrl);

    // Reproduzir com slow+zoom
    playWithEffects(videoUrl);
  };

  mediaRecorder.start();
  setTimeout(() => {
    mediaRecorder.stop();
    stream.getTracks().forEach(track => track.stop());
  }, 10000); // 10 segundos
});

function playWithEffects(url) {
  videoEl.srcObject = null;
  videoEl.src = url;
  videoEl.loop = true;
  videoEl.muted = false;
  videoEl.play();

  // alterna slow/fast
  setInterval(() => {
    videoEl.playbackRate = videoEl.playbackRate === 0.5 ? 2 : 0.5;
  }, 4000);

  // zoom org√¢nico
  let scale = 1, dir = 1;
  const speed = 0.0008;
  function zoom() {
    scale += dir * speed;
    if (scale > 1.6) dir = -1;
    if (scale < 1) dir = 1;
    videoEl.style.transform = `scale(${scale})`;
    requestAnimationFrame(zoom);
  }
  zoom();
}
</script>

</body>
</html>
