<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GravaÃ§Ã£o</title>
<style>
body { background:black; color:white; font-family:Arial; text-align:center; margin:0; padding:0; }
.video-wrapper { width:100%; max-width:500px; margin:0 auto; overflow:hidden; border:2px solid gold; border-radius:10px; }
video { width:100%; display:block; transform-origin:center center; }
button { padding:10px 20px; margin-top:10px; font-size:16px; background:gold; border:none; border-radius:5px; cursor:pointer; }
</style>
</head>
<body>

<h2>ðŸŽ¥ GravaÃ§Ã£o</h2>
<div class="video-wrapper">
  <video id="preview" autoplay playsinline></video>
</div>
<br>
<button id="startBtn">ðŸŽ¬ Gravar</button>
<br><br>
<div id="qrcode"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
let stream, recordedChunks=[], mediaRecorder;

async function startCamera(){
  stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
  document.getElementById('preview').srcObject = stream;
}
startCamera();

document.getElementById('startBtn').addEventListener('click', ()=>{
  recordedChunks=[];
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.ondataavailable = e=>{ if(e.data.size>0) recordedChunks.push(e.data); };
  mediaRecorder.onstop = ()=>{
    const blob = new Blob(recordedChunks,{type:'video/webm'});
    const url = URL.createObjectURL(blob);

    // Gerar QR Code para o playback.html com o blob como parÃ¢metro
    // Convertendo blob para base64 para passar na URL
    const reader = new FileReader();
    reader.onload = () => {
      const base64 = reader.result.split(',')[1];
      const qrUrl = `playback.html?video=${encodeURIComponent(base64)}`;
      document.getElementById('qrcode').innerHTML='';
      new QRCode(document.getElementById('qrcode'), qrUrl);
    };
    reader.readAsDataURL(blob);
  };
  mediaRecorder.start();
  setTimeout(()=>mediaRecorder.stop(),10000); // grava 10s
});
</script>
</body>
</html>
