<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Playback Zoom + Slow</title>
<style>
body { background:black; color:white; font-family:Arial; text-align:center; margin:0; padding:0; }
h1 { color:gold; }
.video-wrapper { width:100%; max-width:500px; margin:20px auto; overflow:hidden; border:2px solid gold; border-radius:10px; }
video { width:100%; display:block; transform-origin:center center; }
button { background:gold; color:black; padding:10px 20px; border:none; border-radius:5px; font-size:16px; margin:10px; cursor:pointer; }
#qrcode { margin-top:20px; }
</style>
</head>
<body>

<h1>游꿘 Grava칞칚o + Zoom + Slow Motion</h1>
<div class="video-wrapper">
  <video id="camera" autoplay muted playsinline></video>
</div>
<br>
<button id="startBtn">郊윒잺 Gravar 10s</button>
<div id="qrcode"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const CLOUD_NAME = "dxobnhynf";
const UPLOAD_PRESET = "ml_default"; // seu preset
const cameraVideo = document.getElementById("camera");
let mediaRecorder, recordedChunks = [], stream, zoomInterval;

// Abre a c칙mera traseira se poss칤vel
async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { exact: "environment" } }, audio: false });
  cameraVideo.srcObject = stream;
}
startCamera();

document.getElementById("startBtn").addEventListener("click", async () => {
  recordedChunks = [];
  mediaRecorder = new MediaRecorder(stream);
  
  mediaRecorder.ondataavailable = e => { if(e.data.size>0) recordedChunks.push(e.data); };
  
  mediaRecorder.onstop = async () => {
    // Cria blob do v칤deo gravado
    const blob = new Blob(recordedChunks, { type: 'video/webm' });

    // Upload para Cloudinary
    const file = new File([blob], "video.webm", { type: 'video/webm' });
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    const res = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/video/upload`, { method:"POST", body:formData });
    const data = await res.json();
    const videoUrl = data.secure_url;

    // Mostra QR Code
    document.getElementById("qrcode").innerHTML = "";
    new QRCode(document.getElementById("qrcode"), videoUrl);

    // Reproduzir com slow + zoom
    playVideoEffects(videoUrl);
  };

  mediaRecorder.start();
  
  // Zoom org칙nico durante a grava칞칚o
  let scale = 1, dir = 1;
  zoomInterval = setInterval(() => {
    scale += dir*0.01;
    if(scale>=1.6) dir=-1;
    if(scale<=1) dir=1;
    cameraVideo.style.transform = `scale(${scale})`;
  }, 50);

  // Para grava칞칚o ap칩s 10s
  setTimeout(()=>{
    mediaRecorder.stop();
    clearInterval(zoomInterval);
    stream.getTracks().forEach(track=>track.stop());
    cameraVideo.style.transform = "scale(1)";
  }, 10000);
});

function playVideoEffects(url) {
  cameraVideo.srcObject = null;
  cameraVideo.src = url;
  cameraVideo.loop = true;
  cameraVideo.muted = false;
  cameraVideo.playbackRate = 0.5; // faz 10s virar 20s
  cameraVideo.play();

  // alterna velocidade a cada 4s
  setInterval(()=>{
    cameraVideo.playbackRate = cameraVideo.playbackRate===0.5 ? 2 : 0.5;
  },4000);

  // zoom org칙nico no v칤deo final
  let scale = 1, dir = 1;
  function zoom() {
    scale += dir*0.0008;
    if(scale>=1.6) dir=-1;
    if(scale<=1) dir=1;
    cameraVideo.style.transform = `scale(${scale})`;
    requestAnimationFrame(zoom);
  }
  zoom();
}
</script>

</body>
</html>
